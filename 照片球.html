<!DOCTYPE html>
<html>

<head>
  <title>three.js css3d - periodic table</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
  <style>
    body {
      margin: 0;
      background-color: #000;
      color: #fff;
      font-family: Monospace;
      font-size: 13px;
      line-height: 24px;
      overscroll-behavior: none;
    }

    .element {
      width: 120px;
      height: 160px;
      box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.5);
      border: 1px solid rgba(127, 255, 255, 0.25);
      font-family: Helvetica, sans-serif;
      text-align: center;
      line-height: normal;
      cursor: default;
    }
    .element .img {
      width: 100%;
      height: 160px;
    }

    .element:hover {
      box-shadow: 0px 0px 12px rgba(0, 255, 255, 0.75);
      border: 1px solid rgba(127, 255, 255, 0.75);
    }

  </style>
</head>

<body>
  <div id="container"></div>
  <!-- Import maps polyfill -->
  <!-- Remove this when import maps will be widely supported -->
  <script async src="https://unpkg.com/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
  <script type="importmap">
    {
      "imports": {
        "three": "https://threejs.org/build/three.module.js",
        "TWEEN": "https://threejs.org/examples/jsm/libs/tween.module.js"
      }
    }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import TWEEN from "TWEEN";
    import { OrbitControls } from "https://threejs.org/examples/jsm/controls/OrbitControls.js"
    // import { TrackballControls } from 'https://threejs.org/examples/jsm/controls/TrackballControls.js';
    import { CSS3DRenderer, CSS3DObject } from 'https://threejs.org/examples/jsm/renderers/CSS3DRenderer.js';
    const table = [];

    let camera, scene, renderer;
    let controls;
    const objects = [];
    const targets = { table: [], sphere: [], helix: [], grid: [] };
    init();
    animate();
    function init() {
      camera = new THREE.PerspectiveCamera(40, window.innerWidth / window.innerHeight, 1, 10000);
      camera.position.z = 3000;
      scene = new THREE.Scene();
      // table
      //
      for (let i = 0; i < 180; i++) {
        const element = document.createElement('div');
        element.className = 'element';
        element.style.backgroundColor = 'rgba(0,127,127,' + (Math.random() * 0.5 + 0.25) + ')';
        const img = document.createElement('img');
        img.className = 'img';
        img.src = `./img/${i % 20}.jpg`;
        element.appendChild(img);
        const objectCSS = new CSS3DObject(element);
        objectCSS.position.x = Math.random() * 4000 - 2000;
        objectCSS.position.y = Math.random() * 4000 - 2000;
        objectCSS.position.z = Math.random() * 4000 - 2000;
        scene.add(objectCSS);
        objects.push(objectCSS);
        // table todo
        // const object = new THREE.Object3D();
        // object.position.x = (table[i + 3] * 140) - 1330;
        // object.position.y = - (table[i + 4] * 180) + 990;
        // targets.table.push(object);
      }
      // sphere
      const vector = new THREE.Vector3();
      for (let i = 0, l = objects.length; i < l; i++) {
        const phi = Math.acos(- 1 + (2 * i) / l);
        const theta = Math.sqrt(l * Math.PI) * phi;
        const object = new THREE.Object3D();
        object.position.setFromSphericalCoords(800, phi, theta);
        vector.copy(object.position).multiplyScalar(2);
        object.lookAt(vector);
        targets.sphere.push(object);
      }
      //
      renderer = new CSS3DRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.getElementById('container').appendChild(renderer.domElement);
      controls = new OrbitControls(camera, renderer.domElement);
      controls.minDistance = 500;
      controls.maxDistance = 6000;
      controls.autoRotate = true;
      controls.autoRotateSpeed = 5;
      controls.addEventListener('change', render);
      transform(targets.sphere, 2000);
      window.addEventListener('resize', onWindowResize);

    }
    let rotate = 0;
    function transform(targets, duration) {
      TWEEN.removeAll();
      for (let i = 0; i < objects.length; i++) {
        const object = objects[i];
        const target = targets[i];
        new TWEEN.Tween(object.position)
          .to({ x: target.position.x, y: target.position.y, z: target.position.z}, Math.random() * duration + duration)
          .easing(TWEEN.Easing.Exponential.InOut)
          .start();
          console.log(object.rotation);
        new TWEEN.Tween(object.rotation)
          .to({ x: target.rotation.x, y: target.rotation.y, z: target.rotation.z }, Math.random() * duration + duration)
          .easing(TWEEN.Easing.Exponential.InOut)
          .start();
      }
      new TWEEN.Tween(this)
        .to({}, duration * 2)
        .onUpdate(render)
        .start();
    }
    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
      render();
    }
    function animate() {
      requestAnimationFrame(animate);
      TWEEN.update();
      controls.update();
    }
    function render() {
      renderer.render(scene, camera);
    }
  </script>
</body>

</html>